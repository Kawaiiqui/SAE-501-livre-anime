<div class="conte-viewer">
  <!-- Écran de chargement -->
  <div class="loading-screen" *ngIf="isLoading" @fadeIn>
    <div class="spinner"></div>
    <p>Chargement du conte...</p>
  </div>

  <!-- Contenu principal -->
  <div class="viewer-container" *ngIf="!isLoading">
    
    <header class="top-nav">
      <button class="menu-btn" (click)="toggleMenu()" aria-label="Menu">
        <span class="hamburger"></span>
        <span class="hamburger"></span>
        <span class="hamburger"></span>
      </button>
      
      <div class="progress-container">
        <div class="progress-bar" [style.width.%]="progress"></div>
      </div>
      
      <div class="page-counter">
        {{ currentSlideIndex + 1 }} / {{ slides.length }}
      </div>
    </header>

    <!-- Slide actuelle -->
    <main class="slide-container" [@slideAnimation]="currentSlideIndex">
      <div class="slide" 
           [style.background-image]="'url(' + currentSlide.imageUrl + ')'"
           [style.background-color]="currentSlide.backgroundColor">
        <!-- Responsive image fallback: ensures full image is visible and scales with viewport -->
        <img class="slide-img" [src]="currentSlide.imageUrl" alt="{{ currentSlide.title }}" aria-hidden="true" />
        
        <!-- Overlay pour améliorer la lisibilité -->
        <div class="slide-overlay"></div>
        
        <!-- Textes positionnés -->
        <div class="text-elements">
          <div *ngFor="let textElement of currentSlide.textElements" 
               class="text-element"
               [style.top]="textElement.position.top"
               [style.bottom]="textElement.position.bottom"
               [style.left]="textElement.position.left"
               [style.right]="textElement.position.right"
               [ngStyle]="textElement.style">
            {{ textElement.content }}
          </div>
        </div>
        
        <!-- Animation spéciale pour la slide 2 avec les fleurs -->
        <div *ngIf="isFlowerSlide" class="flowers-animation">
          <img src="assets/pictures/slide1_blanche.png" 
               class="flower flower-white"
               @flowerEnter
               [@flowerRotate]="flowerRotationState"
               alt="Fleur blanche">
          <img src="assets/pictures/slide1_rouge.png" 
               class="flower flower-red"
               @flowerEnter
               [@flowerRotate]="flowerRotationState"
               alt="Fleur rouge">
        </div>

           <div *ngIf="currentSlideIndex === 0">
          <div class="golden-sparkle sparkle-1"></div>
          <div class="golden-sparkle sparkle-2"></div>
          <div class="golden-sparkle sparkle-3"></div>
          <div class="golden-sparkle sparkle-4"></div>
          <div class="golden-sparkle sparkle-5"></div>
          <div class="golden-sparkle sparkle-6"></div>
          <div class="golden-sparkle sparkle-7"></div>
          <div class="golden-sparkle sparkle-8"></div>
          <div class="golden-sparkle sparkle-9"></div>
          <div class="golden-sparkle sparkle-10"></div>
          <div class="white-sparkle sparkle-11"></div>
          <div class="white-sparkle sparkle-12"></div>
          <div class="white-sparkle sparkle-13"></div>
          <div class="white-sparkle sparkle-14"></div>
          <div class="white-sparkle sparkle-15"></div>
          <div class="white-sparkle sparkle-16"></div>
          <div class="white-sparkle sparkle-17"></div>
          <div class="white-sparkle sparkle-18"></div>
        </div>

        <div *ngIf="currentSlideIndex === 28">
          <div class="golden-sparkle sparkle-19"></div>
          <div class="golden-sparkle sparkle-20"></div>
          <div class="golden-sparkle sparkle-21"></div>
          <div class="golden-sparkle sparkle-22"></div>
          <div class="golden-sparkle sparkle-23"></div>
          <div class="golden-sparkle sparkle-24"></div>
          <div class="white-sparkle sparkle-25"></div>
          <div class="white-sparkle sparkle-26"></div>
          <div class="white-sparkle sparkle-27"></div>
          <div class="white-sparkle sparkle-28"></div>
          <div class="white-sparkle sparkle-29"></div>
          <div class="white-sparkle sparkle-30"></div>
          <div class="white-sparkle sparkle-31"></div>
          <div class="white-sparkle sparkle-32"></div>
        </div>
        </div>

        <div class="text-elements">

        <!-- Rayons de soleil pour la slide 3 (index 2) et slide 14 (index 13) -->
        <div *ngIf="currentSlideIndex === 2 || currentSlideIndex === 13" class="sun-rays" aria-hidden="true">
          <div class="sun-ray ray-1"></div>
          <div class="sun-ray ray-2"></div>
        </div>

        <!-- Trois 'Z' pour indiquer le sommeil sur la slide 5 (index 4) -->
        <div *ngIf="currentSlideIndex === 4" class="sleep-z" aria-hidden="true">
          <span class="z z1">Z</span>
          <span class="z z2">Z</span>
          <span class="z z3">Z</span>
        </div>

        <!-- Rayon angélique principal (milieu haut -> milieu bas) pour slide 6 — fade in/out toutes les 5s -->
        <div *ngIf="currentSlideIndex === 5" class="angel-ray" aria-hidden="true">
          <div class="beam" role="presentation"></div>
        </div>
        
        <!-- Ondes de choc rondes pour la slide 9 (index 8) -->
        <div *ngIf="currentSlideIndex === 8" class="shockwaves" aria-hidden="true">
          <div class="wave wave-1" aria-hidden="true"></div>
          <div class="wave wave-2" aria-hidden="true"></div>
          <div class="wave wave-3" aria-hidden="true"></div>
        </div>
        
          <!-- Motif centré animé pour la slide 15 (index 14) -->
          <div *ngIf="currentSlideIndex === 14" class="center-motif" aria-hidden="true">
            <!-- Inline SVG with curved strokes to match reference -->
            <svg class="motif-svg" width="220" height="140" viewBox="0 0 220 140" role="presentation" aria-hidden="true">
              <g fill="none" stroke="#0b0b0b" stroke-linecap="round" stroke-linejoin="round" stroke-width="6">
                <path class="stroke s1" d="M34 96c22-6 28-38 46-40" />
                <path class="stroke s2" d="M138 38c14-12 26-6 34 4" />
                <path class="stroke s3" d="M80 110c10-8 26-20 42-12" />
              </g>
            </svg>
          </div>
        
          <!-- Poils blancs tombants pour la slide 17 (index 16) -->
          <div *ngIf="currentSlideIndex === 16" class="falling-hairs" aria-hidden="true">
            <div class="hair h1"></div>
            <div class="hair h2"></div>
            <div class="hair h3"></div>
            <div class="hair h4"></div>
            <div class="hair h5"></div>
          </div>
      </div>
    </main>

    <!-- Flèches de navigation -->
    <nav class="slide-navigation">
      <button class="nav-arrow nav-arrow-left" 
              (click)="previousSlide()" 
              [disabled]="currentSlideIndex === 0"
              [class.disabled]="currentSlideIndex === 0"
              aria-label="Slide précédente">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      
      <button class="nav-arrow nav-arrow-right" 
              (click)="nextSlide()" 
              [disabled]="currentSlideIndex === slides.length - 1"
              [class.disabled]="currentSlideIndex === slides.length - 1"
              aria-label="Slide suivante">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </nav>

    <!-- Menu latéral avec pagination -->
    <aside class="side-menu" [class.open]="isMenuOpen">
      <div class="menu-overlay" (click)="toggleMenu()"></div>
      
      <div class="menu-content">
        <header class="menu-header">
          <h2>Table des matières</h2>
          <button class="close-btn" (click)="toggleMenu()" aria-label="Fermer le menu">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </header>
        
        <nav class="menu-list">
          <button *ngFor="let slide of slides; let i = index" 
                  class="menu-item"
                  [class.active]="i === currentSlideIndex"
                  (click)="goToSlide(i)">
            <div class="menu-item-thumbnail" 
                 [style.background-image]="'url(' + slide.imageUrl + ')'">
            </div>
            <div class="menu-item-info">
              <span class="menu-item-number">{{ i + 1 }}</span>
              <span class="menu-item-title">{{ slide.title }}</span>
            </div>
          </button>
        </nav>
      </div>
    </aside>

    <!-- Indicateurs de slide (Tablette) -->
    <div class="slide-indicators" *ngIf="isTablet">
      <span *ngFor="let slide of slides; let i = index" 
            class="indicator"
            [class.active]="i === currentSlideIndex"
            (click)="goToSlide(i)">
      </span>
    </div>
  </div>
</div>